# –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ?

–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –æ–±—É—á–µ–Ω–∏—è GNN –º–æ–¥–µ–ª–µ–π:
- ‚úÖ –£–º–µ–Ω—å—à–µ–Ω learning rate (0.001 ‚Üí 0.0001)
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (init_scale: 0.01 ‚Üí 0.1)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω gradient clipping
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è embeddings (–ö–†–ò–¢–ò–ß–ù–û!)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω learning rate warmup
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω patience –¥–ª—è early stopping (20 ‚Üí 50)

–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏ –≤ `FIXES_APPLIED.md`

## –ó–∞–ø—É—Å–∫ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤

### –í–∞—Ä–∏–∞–Ω—Ç 1: –í—Å–µ –º–æ–¥–µ–ª–∏ –Ω–∞ –≤—Å–µ—Ö –¥–∞—Ç–∞—Å–µ—Ç–∞—Ö

```bash
cd gnn-recommendations
python scripts/run_all_experiments.py
```

‚ö†Ô∏è **–í–Ω–∏–º–∞–Ω–∏–µ**: –î–∞—Ç–∞—Å–µ—Ç Gowalla —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –¥–ª—è RTX 4060 (8GB). –û–Ω –±—É–¥–µ—Ç –ø–∞–¥–∞—Ç—å —Å OOM.

### –í–∞—Ä–∏–∞–Ω—Ç 2: –¢–æ–ª—å–∫–æ MovieLens –∏ Book Crossing

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `scripts/run_all_experiments.py`:

```python
# –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ Gowalla:
DATASETS = [
    'movie_lens',
    'book_crossing',
    # 'gowalla',  # –°–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π –¥–ª—è RTX 4060
]
```

–ó–∞—Ç–µ–º –∑–∞–ø—É—Å—Ç–∏—Ç–µ:

```bash
python scripts/run_all_experiments.py
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –û–¥–Ω–∞ –º–æ–¥–µ–ª—å –Ω–∞ –æ–¥–Ω–æ–º –¥–∞—Ç–∞—Å–µ—Ç–µ

```bash
# LightGCN –Ω–∞ MovieLens
python scripts/train_model.py --model lightgcn --dataset movie_lens

# GroupShuffle –Ω–∞ Book Crossing
python scripts/train_model.py --model groupshuffle_gnn --dataset book_crossing
```

## –û–∂–∏–¥–∞–µ–º–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**MovieLens** (610 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, 2269 –∞–π—Ç–µ–º–æ–≤):
- BPR-MF: ~4 –º–∏–Ω—É—Ç—ã
- GNN –º–æ–¥–µ–ª–∏: ~3-5 –º–∏–Ω—É—Ç –∫–∞–∂–¥–∞—è

**Book Crossing** (12587 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, 15294 –∞–π—Ç–µ–º–∞):
- BPR-MF: ~15-20 –º–∏–Ω—É—Ç
- GNN –º–æ–¥–µ–ª–∏: ~15-25 –º–∏–Ω—É—Ç –∫–∞–∂–¥–∞—è

**–í—Å–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã** (7 –º–æ–¥–µ–ª–µ–π √ó 2 –¥–∞—Ç–∞—Å–µ—Ç–∞):
- –ü—Ä–∏–º–µ—Ä–Ω–æ **2-3 —á–∞—Å–∞**

## –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π GNN –º–æ–¥–µ–ª–∏ –¥–æ–ª–∂–Ω—ã:

1. **–ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã** (–Ω–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ!)
2. **–ë—ã—Ç—å —Å–æ–ø–æ—Å—Ç–∞–≤–∏–º—ã —Å BPR-MF** (–Ω–µ –≤ 4 —Ä–∞–∑–∞ —Ö—É–∂–µ)
3. **–ò–º–µ—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π Coverage** (~15-20%, –Ω–µ 1%)
4. **–û–±—É—á–∞—Ç—å—Å—è –¥–æ–ª—å—à–µ** (20-100 —ç–ø–æ—Ö, –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –Ω–∞ 1-–π)

### –ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Ü–µ–ª–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (MovieLens):

```
BPR-MF:           Recall@10 = 0.020-0.025
LightGCN:         Recall@10 = 0.025-0.035  (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ª—É—á—à–µ BPR!)
GCNII:            Recall@10 = 0.020-0.030
DGR:              Recall@10 = 0.022-0.032
LayerGCN:         Recall@10 = 0.023-0.033
GroupShuffle:     Recall@10 = 0.025-0.040  (–Ω–∞—à–∞ –º–æ–¥–µ–ª—å!)
SVD-GCN:          Recall@10 = 0.015-0.025
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–±—É—á–µ–Ω–∏—è

–¢–µ–ø–µ—Ä—å –≤ –ª–æ–≥–∞—Ö –≤—ã–≤–æ–¥–∏—Ç—Å—è learning rate:

```
Epoch   1/300 | LR: 0.000020 | Train Loss: 0.6931 | Recall@10: 0.0059 | NDCG@10: 0.0574
Epoch  10/300 | LR: 0.000100 | Train Loss: 0.3245 | Recall@10: 0.0180 | NDCG@10: 0.1234
Epoch  20/300 | LR: 0.000095 | Train Loss: 0.2156 | Recall@10: 0.0285 | NDCG@10: 0.1856
```

**–ß—Ç–æ —Å–º–æ—Ç—Ä–µ—Ç—å:**
- **LR** –¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Ç–∏ —Å 0 –¥–æ base_lr –∑–∞ –ø–µ—Ä–≤—ã–µ 5 —ç–ø–æ—Ö (warmup)
- **Train Loss** –¥–æ–ª–∂–µ–Ω —É–º–µ–Ω—å—à–∞—Ç—å—Å—è
- **Recall@10** –¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Ç–∏ (–Ω–µ –∑–∞—Å—Ç—Ä–µ–≤–∞—Ç—å –Ω–∞ –æ–¥–Ω–æ–º –∑–Ω–∞—á–µ–Ω–∏–∏!)
- **NDCG@10** –¥–æ–ª–∂–µ–Ω —Ä–∞—Å—Ç–∏

## –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫

### 1. –ú–æ–¥–µ–ª—å –≤—Å—ë –µ—â—ë –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–ª–æ—Ö–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–º–µ–Ω—å—à–∏—Ç—å learning rate –µ—â—ë –±–æ–ª—å—à–µ:

```yaml
# –í config/models/lightgcn.yaml
training:
  learning_rate: 0.00005  # –í–º–µ—Å—Ç–æ 0.0001
```

### 2. Loss –Ω–µ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –Ω–µ –æ–±–Ω—É–ª—è—é—Ç—Å—è:

```python
# –î–æ–±–∞–≤—å—Ç–µ –≤ train_epoch –ø–æ—Å–ª–µ backward:
total_norm = 0
for p in self.model.parameters():
    if p.grad is not None:
        param_norm = p.grad.data.norm(2)
        total_norm += param_norm.item() ** 2
total_norm = total_norm ** 0.5
print(f"Gradient norm: {total_norm:.4f}")
```

### 3. CUDA out of memory

–£–º–µ–Ω—å—à–∏—Ç–µ batch size:

```yaml
# –í config/models/*.yaml
training:
  batch_size: 1024  # –í–º–µ—Å—Ç–æ 2048
```

### 4. –û–±—É—á–µ–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ–µ

–£–≤–µ–ª–∏—á—å—Ç–µ eval_every:

```yaml
# –í config/training.yaml
eval_every: 20  # –í–º–µ—Å—Ç–æ 10 (–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ä–µ–∂–µ)
```

## –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–æ–≤:

```bash
# –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤:
results/experiments/all_experiments_YYYYMMDD_HHMMSS.json
results/experiments/all_experiments_YYYYMMDD_HHMMSS.csv

# –ß–µ–∫–ø–æ–∏–Ω—Ç—ã –ª—É—á—à–∏—Ö –º–æ–¥–µ–ª–µ–π:
results/checkpoints/{model_name}/{dataset_name}/best_model.pt
```

–°—Ä–∞–≤–Ω–∏—Ç–µ —Å –ø—Ä–µ–¥—ã–¥—É—â–∏–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏:

```python
import json
import pandas as pd

# –ó–∞–≥—Ä—É–∑–∏—Ç–µ –Ω–æ–≤—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
with open('results/experiments/all_experiments_20260109_XXXXXX.json') as f:
    new_results = json.load(f)

# –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
with open('results/experiments/all_experiments_20260109_165129.json') as f:
    old_results = json.load(f)

# –°—Ä–∞–≤–Ω–∏—Ç–µ
for new, old in zip(new_results, old_results):
    if new['status'] == 'success' and old['status'] == 'success':
        model = new['model']
        dataset = new['dataset']
        new_recall = new['test_metrics']['recall@10']
        old_recall = old['test_metrics']['recall@10']
        improvement = (new_recall - old_recall) / old_recall * 100
        print(f"{model:20s} {dataset:15s}: {old_recall:.4f} ‚Üí {new_recall:.4f} ({improvement:+.1f}%)")
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —É–ª—É—á—à–∏–ª–∏—Å—å
3. –ï—Å–ª–∏ –Ω—É–∂–Ω–æ, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –≥–∏–ø–µ—Ä–ø–∞—Ä–∞–º–µ—Ç—Ä—ã
4. –î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É Gowalla (—Å—ç–º–ø–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–ª–∏ CPU)
5. –ü—Ä–æ–≤–µ–¥–∏—Ç–µ ablation studies
6. –í–∏–∑—É–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

–£–¥–∞—á–∏! üöÄ

